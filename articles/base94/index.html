<!DOCTYPE html><html lang=en> <head><meta charset=utf-8><title>Convert binary data to a text with the lowest overhead - Vorakl's notes</title><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=robots content=all><link href=https://vorakl.com/articles/base94/ rel=canonical><meta name=description content="A binary-to-text encoding with any radix from 2 to 94"><link rel=stylesheet href="https://vorakl.com/theme/bootstrap-pygments.bundle.min.css?v=1747460791"><link rel=alternate type=application/atom+xml href=https://vorakl.com/atom.xml title="Vorakl's notes"><meta name=theme-color content=#205081><link rel="shortcut icon" href="/favicon.ico?v=1747460791"><link rel=apple-touch-icon sizes=180x180 href="/favicon/apple-touch-icon.png?v=1747460791"><link rel=icon type=image/png sizes=32x32 href="/favicon/favicon-32x32.png?v=1747460791"><link rel=icon type=image/png sizes=16x16 href="/favicon/favicon-16x16.png?v=1747460791"><link rel=manifest href="/favicon/manifest.json?v=1747460791"><meta name=apple-mobile-web-app-title content="Vorakl's notes"><meta name=application-name content="Vorakl's notes"></head> <body> <div class=navbar> <div class=navbar-inner> <div class=container> <a href=https://vorakl.com/ class=brand>Vorakl's notes</a> <div class=nav-collapse> <ul class="nav pull-right"> <!-- <li class="divider-vertical"></li> --> <li><a href=https://vorakl.com/pages/contacts/ >Contacts</a></li> <li><a href=https://vorakl.com/pages/about/ >About</a></li> <!-- <li class="divider-vertical"></li> --> </ul> </div> </div> </div> </div> <div class=container> <div class=content> <div class=row> <div class=span12> <div class=article> <div class=content-title> <h1>Convert binary data to a text with the lowest overhead</h1> <div class="well small">on 2020-04-18 in <a href=https://vorakl.com/categories/article/ >article</a> about <a href=https://vorakl.com/tags/cs/ >cs</a> <a href=https://vorakl.com/tags/binary-to-text/ >binary-to-text</a> <a href=https://vorakl.com/tags/encoding/ >encoding</a> ~5 min read </div> <p><h3 style="text-decoration-line: none">A binary-to-text encoding with any radix from 2 to 94</h3></p> </div> <div class=content><p><a class="reference internal" href=#summary>TLDR: quick summary of the article</a></p> <div class=line-block> <div class=line><br></div> </div> <p>This article discusses <a class="reference external" href=https://en.wikipedia.org/wiki/Binary-to-text_encoding>binary/text converters</a>, the most popular implementations, and a non-standard approach that uses <a class="reference external" href=https://merrigrove.blogspot.com/2014/04/what-heck-is-base64-encoding-really.html>place-based single-number encoding</a> by representing a file as a large number and then converting it to another large number with any non-256 (1-byte/8-bit) radix. To make it practical, it makes sense to limit a radix (base) to 94 for matching numbers to all possible printable symbols within the 7-bit <a href=https://www.ascii-code.com/ class="reference external">ASCII</a> table. It is probably a theoretical prototype and has a purely academic flavor, as the time and space complexities make it applicable only to small files (up to a few tens of kilobytes), although it allows one to choose any base with no dependencies on powers of two, e.g. 7 or 77.</p> <div class=line-block> <div class=line><br></div> </div> <div class=section id=background> <h2>Background</h2> <p>The main purpose of such converters is to convert a binary file represented by 256 different symbols (radix-256, 1 byte, 2^8) into a form suitable for transmission over a channel with a limited range of supported symbols. A good example is any text-based network protocol, such as HTTP (before ver. 2) or SMTP, where all transmitted binary data must be reversibly converted to a pure text form without control symbols. As you may know, ASCII codes from 0 to 31 are considered control characters, and therefore will definitely be lost during transmission over any logical channel that doesn't allow endpoints to transmit full 8-bit bytes (binary) with codes from 0 to 255. This limits the number of allowed symbols to less than 224 (256-32), but it's actually limited by the first 128 (2^7, 7 bits) standardized symbols in the ASCII table, and even more.</p> <div class=line-block> <div class=line><br></div> </div> <p>The standard solution today is the Base64 algorithm defined in <a class="reference external" href=https://tools.ietf.org/html/rfc4648>RFC 4648</a> (easy to read and understand). It also describes Base32 and Base16 as possible variants. The key point here is that they all share the same property of being powers of two. The wider the range of supported symbols (codes), the more space-efficient the result of the conversion. It will be larger anyway, the question is how much larger. For example, Base64 encoding gives about 33% larger output, because 3 input bytes (8 valued bits) are translated into 4 output bytes (6 valued bits, 2^6=64). So the ratio is always 4/3, i.e. the output is larger by 1/3 or 33.(3)%. Practically speaking, Base32 is very inefficient because it means translating 5 input bytes (8 valued bits) into 8 output bytes (5 valued bits, 2^5=32) and the ratio is 8/5, i.e. the output is larger by 3/5 or 60%. In this context, it is hard to consider any kind of efficiency of Base16, since its output size is larger by 100% (each byte of 8 valued bits is represented by two bytes of 4 valued bits, also known as <a class="reference external" href=https://en.wikipedia.org/wiki/Nibble>nibbles</a>, 2^4=16). By the way, this is a well-used representation of 8-bit bytes, called hexadecimal.</p> <div class=line-block> <div class=line><br></div> </div> <p>If you're curious how these input/output byte ratios were calculated for the Base64/32/16 encodings, the answer is LCM (Least Common Multiple). Let's calculate it ourselves, and for that we need another function, the GCD (Greatest Common Divisor)</p> <div class=line-block> <div class=line><br></div> </div> <ol class="arabic simple"> <li><dl class="first docutils"> <dt>Base64 (Input: 8 bits, Output: 6 bits):</dt> <dd><ul class="first last"> <li>LCM(8, 6) = 8*6/GCD(8,6) = 24 bit</li> <li>Input: 24 / 8 = 3 bytes</li> <li>Output: 24 / 6 = 4 bytes</li> <li>Ratio (Output/Input): 4/3</li> </ul> </dd> </dl> </li> <li><dl class="first docutils"> <dt>Base32 (Input: 8 bits, Output: 5 bits):</dt> <dd><ul class="first last"> <li>LCM(8, 5) = 8*5/GCD(8,5) = 40 bit</li> <li>Input: 40 / 8 = 5 bytes</li> <li>Output: 40 / 5 = 8 bytes</li> <li>Ratio (Output/Input): 8/5</li> </ul> </dd> </dl> </li> <li><dl class="first docutils"> <dt>Base16 (Input: 8 bits, Output: 4 bits):</dt> <dd><ul class="first last"> <li>LCM(8, 4) = 8*4/GCD(8,4) = 8 bit</li> <li>Input: 8 / 8 = 1 byte</li> <li>Output: 8 / 4 = 2 bytes</li> <li>Ratio (Output/Input): 2/1</li> </ul> </dd> </dl> </li> </ol> <div class=line-block> <div class=line><br></div> </div> </div> <div class=section id=the-key-problem> <h2>The key problem</h2> <p>What if a channel is only capable of transmitting a few different symbols, such as 9 or 17? That is, we have a file represented by a 256-symbol alphabet (a normal 8-bit byte), we are not really limited by computing power or memory constraints on either side, but we are only able to send 7 different symbols instead of 256? Base64/32/16 are not a solution here. Then Base7 is the only possible output format.</p> <div class=line-block> <div class=line><br></div> </div> <p>Another example, what if the amount of data transmitted is a concern for a channel? Base64, as it has been shown, increases the data by 33%, no matter what is transmitted, always. Base94, for example, only increases the output by 22%.</p> <div class=line-block> <div class=line><br></div> </div> <p>It may seem that Base94 is not the limit. If the first 32 ASCII codes are control characters, and there are 256 codes in total, what stops you from using an alphabet of 256 - 32 = 224 symbols? It turns out that there is a limit. Not all of the 224 ASCII codes are printable characters or have a standard representation. In general, only 7 bits (0..127) are standardized, and the rest (128..255) is used for the variety of locales, e.g. Koi8-R, Windows-1251, etc. This means that only 128 - 32 = 96 are available in the standardized range. In addition, the ASCII code 32 is the space character, and 127 doesn't have a visible character either. So 96 - 2 gives us the 94 printable characters that have the same association with their codes on most machines.</p> <div class=line-block> <div class=line><br></div> </div> </div> <div class=section id=solution> <h2>Solution</h2> <p>Although <a class="reference external" href=https://github.com/vorakl/base94>this solution</a> is quite simple, this simplicity also imposes a significant computational constraint. The entire input file can be treated as a large number with a base of 256. It could easily be a really big number, requiring thousands of bits. Then all we have to do is convert that big number to a different base. That's it. And Python3 makes it even easier! Normally, conversions between different bases are done via an intermediate base10. The good news is that Python3 has built-in support for large number calculations. The int class has a method that reads any number of bytes and automatically represents them as a large Base10 number with a desired endian. So essentially all of this complexity can be implemented in just two lines of code!</p> <div class=highlight><pre><span></span><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;inpit_file&#39;</span><span class=p>,</span> <span class=s1>&#39;rb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
    <span class=n>in_data</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>(),</span> <span class=s1>&#39;big&#39;</span><span class=p>)</span>
</pre></div> <div class=line-block> <div class=line><br></div> </div> <p>where <em>in_data</em> is the big Base10 number. That's only two lines, but that's where most of the math happens and most of the time is spent. So now convert it to any other base, as you'd normally do with normal small decimal numbers.</p> <div class=line-block> <div class=line><br></div> </div> <p>Read more about stream encoding algorithms with a variable base (16, 32, 36, 64, 58, 85, 94) in my next article <a href=https://vorakl.com/articles/stream-encoding/ class="reference external">The zoo of binary-to-text encoding schemes</a>.</p> <div class=line-block> <div class=line><br></div> </div> </div> <div class=section id=summary> <h2>Summary</h2> <ul class=simple> <li>The article discusses converting binary data to text using different encoding schemes like Base64, Base32, Base16 and a non-standard Base94.</li> <li>To allow transmission over text-based protocols like HTTP and SMTP, standard encoding schemes like Base64 or Base32, represent binary data as powers of two.</li> <li>Base64 increases a file size by around 33% while Base32 increases it by 60% due to their encoding ratios of input to output bytes.</li> <li>For practical purposes, the Base94 may be used to match all printable ASCII characters from 0-127.</li> <li>Base94 is very efficient and increases a file size by only around 22% compared to Base64's 33% increase.</li> <li>Python allows implementing the approach easily using its large number capabilities and byte conversion methods.</li> <li>The key steps of described approach are converting the binary file to a large Base10 number, then converting it to the desired output base.</li> </ul> <div class=line-block> <div class=line><br></div> </div> <!-- Links --> </div> </div> </div> <div class=article style="text-align: center; font-size: 1.1em; font-style: italic"> Found a <span style="color: red; font-weight: bold">bug</span> or <span style="color: red; font-weight: bold">typo</span>? Please, send me <a href=/pages/feedback/ >feedback</a> or submit a <a href=https://github.com/vorakl/vorakl.github.io/blob/master/src.docs/content/articles/base94.rst>PR on Github</a>. </div> <div class=article> <div class="well small"><h5>This is my personal blog. All ideas, opinions, examples, and other information that can be found here are my own and belong entirely to me. This is the result of my personal efforts and activities at my free time. It doesn't relate to any professional work I've done and doesn't have correlations with any companies I worked for, I'm currently working, or will work in the future.</h5></div> </div> </div> </div> </div> <footer> <div class=container> <div class=row> <div class=span5> <span class=pull-left> &copy; 2020 <a href=https://vorakl.com/pages/about/ >vorakl</a> All Rights Reserved </span> </div> <div class=span7> <div class=pull-right> Powered by <a href=https://github.com/getpelican/pelican>Pelican</a> and <a href=https://github.com/vorakl/aves>Aves</a> theme </div> </div> </div> </div> </footer> </div> </body> </html>