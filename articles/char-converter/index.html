<!DOCTYPE html><html lang=en> <head><meta charset=utf-8><title>A converter of a character's case and Ascii codes :: Vorakl's notes</title><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=robots content=all><link href=https://vorakl.com/articles/char-converter/ rel=canonical><meta name=description content="An example of using the Constraint Programming for calculating multiple but linked results"><link rel=stylesheet href="https://vorakl.com/theme/bootstrap-pygments.bundle.min.css?v=1708415962"><link rel=alternate type=application/atom+xml href=https://vorakl.com/atom.xml title="Vorakl's notes"><meta name=theme-color content=#205081><link rel="shortcut icon" href="/favicon.ico?v=1708415962"><link rel=apple-touch-icon sizes=180x180 href="/favicon/apple-touch-icon.png?v=1708415962"><link rel=icon type=image/png sizes=32x32 href="/favicon/favicon-32x32.png?v=1708415962"><link rel=icon type=image/png sizes=16x16 href="/favicon/favicon-16x16.png?v=1708415962"><link rel=manifest href="/favicon/manifest.json?v=1708415962"><meta name=apple-mobile-web-app-title content="Vorakl's notes"><meta name=application-name content="Vorakl's notes"></head> <body> <div class=navbar> <div class=navbar-inner> <div class=container> <a href=https://vorakl.com/ class=brand>Vorakl's notes</a> <div class=nav-collapse> <ul class="nav pull-right"> <!-- <li class="divider-vertical"></li> --> <li><a href=https://vorakl.com/pages/reading/ >Reading</a></li> <li><a href=https://vorakl.com/pages/projects/ >Projects</a></li> <li><a href=https://vorakl.com/pages/contacts/ >Contacts</a></li> <li><a href=https://vorakl.com/pages/about/ >About</a></li> <!-- <li class="divider-vertical"></li> --> </ul> </div> </div> </div> </div> <div class=container> <div class=content> <div class=row> <div class=span12> <div class=article> <div class=content-title> <h2>A converter of a character's case and Ascii codes</h2> <div class="well small">on 2019-08-08 in <a href=https://vorakl.com/categories/article/ >article</a> about <a href=https://vorakl.com/tags/cs/ >cs</a> <a href=https://vorakl.com/tags/programming/ >programming</a> <a href=https://vorakl.com/tags/python/ >python</a> <a href=https://vorakl.com/tags/encoding/ >encoding</a> ~5 min read </div> <p><h3>An example of using the Constraint Programming for calculating multiple but linked results</h3></p> </div> <div class=content><p>The constraint programming paradigm is effectively applied for solving a group of problems which can be translated to variables and constraints or represented as a mathematic equation, and so related to the <a href=https://vorakl.com/articles/csp/ class="reference external">CSP</a>. Using declarative programming style it describes a general model with certain properties. In contrast to the imperative style, it doesn't tell <em>how</em> to achieve something, but rather <em>what</em> to achieve. Instead of defining a set of instructions with only one obvious way for computing values, the constraint programming declares relationships between variables within constraints. A final model makes it possible to compute the values of variables regardless of direction or changes. Thus, any change of the value of one variable affects the whole system (all other variables) and to satisfy defined constraints it leads to recomputing the other values.</p> <div class=line-block> <div class=line><br></div> </div> <p>Let's take, for example, Pythagoras' theorem: <strong>a² + b² = c²</strong>. The <em>constraint</em> is represented by this equation, which has three <em>variables</em> (a, b, and c), and each has a <em>domain</em> (non-negative). Using the imperative programming style, to compute any of these variables having other two, we would need to create three different functions (because each variable is computed by a different equation):</p> <ul class=simple> <li>c = √(a² + b²)</li> <li>a = √(c² - b²)</li> <li>b = √(c² - a²)</li> </ul> <p>These functions satisfy the main constraint and to check domains, each function should validate the input. Moreover, at least one more function would be needed for choosing an appropriate function accordingly to provided variables. This is one of possible solutions:</p> <div class=highlight><pre><span></span><span class=k>def</span> <span class=nf>pythagoras</span><span class=p>(</span><span class=o>*</span><span class=p>,</span> <span class=n>a</span><span class=o>=</span><span class=bp>None</span><span class=p>,</span> <span class=n>b</span><span class=o>=</span><span class=bp>None</span><span class=p>,</span> <span class=n>c</span><span class=o>=</span><span class=bp>None</span><span class=p>):</span>
    <span class=sd>&#39;&#39;&#39; Computes a side of a right triangle &#39;&#39;&#39;</span>

    <span class=c1># Validate</span>
    <span class=k>if</span> <span class=nb>len</span><span class=p>([</span><span class=n>i</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>)</span> <span class=k>if</span> <span class=n>i</span> <span class=ow>is</span> <span class=bp>None</span> <span class=ow>or</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>])</span> <span class=o>!=</span> <span class=mi>1</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>SystemExit</span><span class=p>(</span><span class=s2>&quot;ERROR: you need to define any of two non-negative variables&quot;</span><span class=p>)</span>

    <span class=c1># Compute</span>
    <span class=k>if</span> <span class=n>a</span> <span class=ow>is</span> <span class=bp>None</span><span class=p>:</span>
        <span class=k>return</span> <span class=p>(</span><span class=n>c</span><span class=o>**</span><span class=mi>2</span> <span class=o>-</span> <span class=n>b</span><span class=o>**</span><span class=mi>2</span><span class=p>)</span><span class=o>**</span><span class=mf>0.5</span>
    <span class=k>elif</span> <span class=n>b</span> <span class=ow>is</span> <span class=bp>None</span><span class=p>:</span>
        <span class=k>return</span> <span class=p>(</span><span class=n>c</span><span class=o>**</span><span class=mi>2</span> <span class=o>-</span> <span class=n>a</span><span class=o>**</span><span class=mi>2</span><span class=p>)</span><span class=o>**</span><span class=mf>0.5</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>return</span> <span class=p>(</span><span class=n>a</span><span class=o>**</span><span class=mi>2</span> <span class=o>+</span> <span class=n>b</span><span class=o>**</span><span class=mi>2</span><span class=p>)</span><span class=o>**</span><span class=mf>0.5</span>
</pre></div> <p>To see the difference of the constraint programming approach, I'll show an example of a &quot;problem&quot; with four variables and a constraint that is not represented by a straight mathematic equation. This is a converter that can change a case of the characters (small to/from capital) and return the Ascii codes of both. Hence, at any time the converter is aware of all four values and reacts immediately on any changes. The idea of creating this example was fully inspired by the <a class="reference external" href=https://www.composingprograms.com/pages/24-mutable-data.html#propagating-constraints>Fahrenheit-Celsius converter</a> by John DeNero.</p> <div class=line-block> <div class=line><br></div> </div> <p>Let's take a look on a diagram of a constraint system:</p> <a class="reference external image-reference" href=https://vorakl.com/files/char-converter/char-converter.png><img alt="the diagram" class=img src=https://vorakl.com/files/char-converter/char-converter.png style="width: 100%;"></a> <p>The represented &quot;problem&quot; is translated into a constraint system that consists of nodes (constraint) and connectors (variables). Connectors provide an interface for getting and setting values. They also check the variables' domains. When some value changes, that particular connector notifies all its connected nodes about the change. Nodes, in turn, satisfy constraints, calculate new values and propagate them to other connectors across the system, by &quot;asking&quot; them to set a new value. The propagation is done using the message passing technique that means connectors and nodes get messages (synchronously) and react accordingly. For instance, if the system gets the 'A' letter on the &quot;Capital Letter&quot; connector, all other three connectors provide an appropriate result accordingly to the defined constraint on the nodes: 97, 'a', and 65. And of course, it's not allowed to set on that connector any small letters, e.g. 'b', because each connector has its own domain.</p> <div class=line-block> <div class=line><br></div> </div> <p>When all connectors are linked to nodes, nodes are defined by constraints, the system is fully set and ready to get values on any of four connectors. Once it's set, the system automatically calculates and sets values on the rest connectors. There is no need to check what a variable was set and which functions should be called, as it was needed in the imperative approach which relatively easy to achieve with a few variables but gets interesting in case of tens or more.</p> <div class=line-block> <div class=line><br></div> </div> <p>The full source code is available in my <a class="reference external" href=https://github.com/vorakl/composingprograms.com/tree/master/char_converter>Github repo</a>. Let's now dig a little bit into details and find out how the system is built. Firstly, we define our connectors by giving them names and setting domains as a function of one argument:</p> <div class=highlight><pre><span></span><span class=kn>import</span> <span class=nn>constraint_programming</span> <span class=kn>as</span> <span class=nn>cp</span>

<span class=n>small_ascii</span> <span class=o>=</span> <span class=n>cp</span><span class=o>.</span><span class=n>connector</span><span class=p>(</span><span class=s1>&#39;Small Ascii&#39;</span><span class=p>,</span> <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span> <span class=o>&gt;=</span> <span class=mi>97</span> <span class=ow>and</span> <span class=n>x</span> <span class=o>&lt;=</span> <span class=mi>122</span><span class=p>)</span>
<span class=n>small_letter</span> <span class=o>=</span> <span class=n>cp</span><span class=o>.</span><span class=n>connector</span><span class=p>(</span><span class=s1>&#39;Small Letter&#39;</span><span class=p>,</span> <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span> <span class=o>&gt;=</span> <span class=s1>&#39;a&#39;</span> <span class=ow>and</span> <span class=n>x</span> <span class=o>&lt;=</span> <span class=s1>&#39;z&#39;</span><span class=p>)</span>
<span class=n>capital_ascii</span> <span class=o>=</span> <span class=n>cp</span><span class=o>.</span><span class=n>connector</span><span class=p>(</span><span class=s1>&#39;Capital Ascii&#39;</span><span class=p>,</span> <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span> <span class=o>&gt;=</span> <span class=mi>65</span> <span class=ow>and</span> <span class=n>x</span> <span class=o>&lt;=</span> <span class=mi>90</span><span class=p>)</span>
<span class=n>capital_letter</span> <span class=o>=</span> <span class=n>cp</span><span class=o>.</span><span class=n>connector</span><span class=p>(</span><span class=s1>&#39;Capital Letter&#39;</span><span class=p>,</span> <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span> <span class=o>&gt;=</span> <span class=s1>&#39;A&#39;</span> <span class=ow>and</span> <span class=n>x</span> <span class=o>&lt;=</span> <span class=s1>&#39;Z&#39;</span><span class=p>)</span>
</pre></div> <p>Secondly, we link these connectors to nodes. There are two types: <em>code</em> (translates letters to Ascii codes and back) and <em>aA</em> (translates small letters to capital and back):</p> <div class=highlight><pre><span></span><span class=n>code</span><span class=p>(</span><span class=n>small_letter</span><span class=p>,</span> <span class=n>small_ascii</span><span class=p>)</span>
<span class=n>code</span><span class=p>(</span><span class=n>capital_letter</span><span class=p>,</span> <span class=n>capital_ascii</span><span class=p>)</span>
<span class=n>aA</span><span class=p>(</span><span class=n>small_letter</span><span class=p>,</span> <span class=n>capital_letter</span><span class=p>)</span>
</pre></div> <p>These two nodes are different by functions which should be called and they derived from a general constraint function:</p> <div class=highlight><pre><span></span><span class=k>def</span> <span class=nf>code</span><span class=p>(</span><span class=n>conn1</span><span class=p>,</span> <span class=n>conn2</span><span class=p>):</span>
    <span class=k>return</span> <span class=n>cp</span><span class=o>.</span><span class=n>constraint</span><span class=p>(</span><span class=n>conn1</span><span class=p>,</span> <span class=n>conn2</span><span class=p>,</span> <span class=nb>ord</span><span class=p>,</span> <span class=nb>chr</span><span class=p>)</span>

<span class=k>def</span> <span class=nf>aA</span><span class=p>(</span><span class=n>conn1</span><span class=p>,</span> <span class=n>conn2</span><span class=p>):</span>
    <span class=k>return</span> <span class=n>cp</span><span class=o>.</span><span class=n>constraint</span><span class=p>(</span><span class=n>conn1</span><span class=p>,</span> <span class=n>conn2</span><span class=p>,</span> <span class=nb>str</span><span class=o>.</span><span class=n>upper</span><span class=p>,</span> <span class=nb>str</span><span class=o>.</span><span class=n>lower</span><span class=p>)</span>
</pre></div> <p>Each node has only two connectors. If an update has occurred on a first connector then a first function is called to calculate a value of another connector (variable). The same happens if a second connector changes its value. For example, if the <em>code</em> node gets 'A' on the <em>conn1</em> connector, then the function <em>ord</em> will be used to get its Ascii code. And, the other way around, if the <em>aA</em> node gets 'A' on the <em>conn2</em> connector then it needs to use <em>str.lower</em> function to get an appropriate small letter on the <em>conn1</em>. Every node is responsible for computing new values and &quot;sending&quot; a message to another connector that there is a new value to set. This message is conveyed with the name of a node that is asking to set a new value, and actually a new value.</p> <div class=highlight><pre><span></span><span class=k>def</span> <span class=nf>set_value</span><span class=p>(</span><span class=n>src_constr</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
    <span class=k>if</span> <span class=p>(</span><span class=ow>not</span> <span class=n>domain</span> <span class=ow>is</span> <span class=bp>None</span><span class=p>)</span> <span class=ow>and</span> <span class=p>(</span><span class=ow>not</span> <span class=n>domain</span><span class=p>(</span><span class=n>value</span><span class=p>)):</span>
        <span class=k>raise</span> <span class=n>ValueOutOfDomain</span><span class=p>(</span><span class=n>link</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span>
    <span class=n>link</span><span class=p>[</span><span class=s1>&#39;value&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>value</span>
    <span class=k>for</span> <span class=n>constraint</span> <span class=ow>in</span> <span class=n>constraints</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>constraint</span> <span class=ow>is</span> <span class=ow>not</span> <span class=n>src_constr</span><span class=p>:</span>
            <span class=n>constraint</span><span class=p>[</span><span class=s1>&#39;update&#39;</span><span class=p>](</span><span class=n>link</span><span class=p>)</span>
</pre></div> <p>When a connector receives the &quot;set&quot; message, it runs the &quot;set_value&quot; function to check a domain, sets a new value, and sends the &quot;update&quot; message to another node. It is just a notification that value on that connector has changed.</p> <div class=highlight><pre><span></span><span class=k>def</span> <span class=nf>update</span><span class=p>(</span><span class=n>src_conn</span><span class=p>):</span>
    <span class=k>if</span> <span class=n>src_conn</span> <span class=ow>is</span> <span class=n>conn1</span><span class=p>:</span>
        <span class=n>conn2</span><span class=p>[</span><span class=s1>&#39;set&#39;</span><span class=p>](</span><span class=n>node</span><span class=p>,</span> <span class=n>constr1</span><span class=p>(</span><span class=n>conn1</span><span class=p>[</span><span class=s1>&#39;value&#39;</span><span class=p>]))</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>conn1</span><span class=p>[</span><span class=s1>&#39;set&#39;</span><span class=p>](</span><span class=n>node</span><span class=p>,</span> <span class=n>constr2</span><span class=p>(</span><span class=n>conn2</span><span class=p>[</span><span class=s1>&#39;value&#39;</span><span class=p>]))</span>
</pre></div> <p>Then, the notified node requests this new value on the connector, compute a new value for another connector and so on, until the whole system has changed. That's how the propagation actually work.</p> <div class=line-block> <div class=line><br></div> </div> <p>But, how is the message passing happening? This is implemented as accessing keys of dictionaries. Both functions (connector and constraint) return a <em>dispatch dictionary</em>. Such a dictionary contains <em>messages</em> as keys and closures as values. By accessing a key, let's say, &quot;set&quot;, a dictionary returns the function &quot;set_value&quot; (closure) that has access to all local names of the &quot;connector&quot; function.</p> <div class=highlight><pre><span></span><span class=c1># A dispatch dictionary</span>
<span class=n>link</span> <span class=o>=</span> <span class=p>{</span> <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=n>name</span><span class=p>,</span>
         <span class=s1>&#39;value&#39;</span><span class=p>:</span> <span class=bp>None</span><span class=p>,</span>
         <span class=s1>&#39;connect&#39;</span><span class=p>:</span> <span class=n>connect</span><span class=p>,</span>
         <span class=s1>&#39;set&#39;</span><span class=p>:</span> <span class=n>set_value</span><span class=p>,</span>
         <span class=s1>&#39;constraints&#39;</span><span class=p>:</span> <span class=n>get_constraints</span> <span class=p>}</span>

<span class=k>return</span> <span class=n>link</span>
</pre></div> <p>Having a dictionary as a return value makes it possible to create multiple closures (functions) with access to the same local state to operate on. Then, these closures are callable by using keys as a sort of messages.</p> <!-- Links --> </div> </div> <div class=article style="text-align: center; font-size: 1.1em; font-style: italic"> Found a <span style="color: red; font-weight: bold">bug</span> or <span style="color: red; font-weight: bold">typo</span>? Please, send me <a href=/pages/feedback/ >feedback</a> or submit a <a href=https://github.com/vorakl/vorakl.github.io/blob/master/src.docs/content/articles/char-converter.rst>PR on Github</a>. </div> <div class=article> <div class="well small"><h5>This is my personal blog. All ideas, opinions, examples, and other information that can be found here are my own and belong entirely to me. This is the result of my personal efforts and activities at my free time. It doesn't relate to any professional work I've done and doesn't have correlations with any companies I worked for, I'm currently working, or will work in the future.</h5></div> </div> </div> </div> </div> <footer> <div class=container> <div class=row> <div class=span5> <span class=pull-left> &copy; 2019 <a href=https://vorakl.com/pages/about/ >vorakl</a> All Rights Reserved </span> </div> <div class=span7> <div class=pull-right> Powered by <a href=https://github.com/getpelican/pelican>Pelican</a> and <a href=https://github.com/vorakl/aves>Aves</a> theme </div> </div> </div> </div> </footer> </div> </body> </html>