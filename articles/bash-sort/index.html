<!DOCTYPE html><html lang=en> <head><meta charset=utf-8><title>How to sort arrays natively in Bash - Vorakl's notes</title><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=robots content=all><link href=https://vorakl.com/articles/bash-sort/ rel=canonical><meta name=description content="Sorting arrays in pure Bash with the asort built-in command"><link rel=stylesheet href="https://vorakl.com/theme/bootstrap-pygments.bundle.min.css?v=1714445982"><link rel=alternate type=application/atom+xml href=https://vorakl.com/atom.xml title="Vorakl's notes"><meta name=theme-color content=#205081><link rel="shortcut icon" href="/favicon.ico?v=1714445982"><link rel=apple-touch-icon sizes=180x180 href="/favicon/apple-touch-icon.png?v=1714445982"><link rel=icon type=image/png sizes=32x32 href="/favicon/favicon-32x32.png?v=1714445982"><link rel=icon type=image/png sizes=16x16 href="/favicon/favicon-16x16.png?v=1714445982"><link rel=manifest href="/favicon/manifest.json?v=1714445982"><meta name=apple-mobile-web-app-title content="Vorakl's notes"><meta name=application-name content="Vorakl's notes"></head> <body> <div class=navbar> <div class=navbar-inner> <div class=container> <a href=https://vorakl.com/ class=brand>Vorakl's notes</a> <div class=nav-collapse> <ul class="nav pull-right"> <!-- <li class="divider-vertical"></li> --> <li><a href=https://vorakl.com/pages/reading/ >Reading</a></li> <li><a href=https://vorakl.com/pages/projects/ >Projects</a></li> <li><a href=https://vorakl.com/pages/contacts/ >Contacts</a></li> <li><a href=https://vorakl.com/pages/about/ >About</a></li> <!-- <li class="divider-vertical"></li> --> </ul> </div> </div> </div> </div> <div class=container> <div class=content> <div class=row> <div class=span12> <div class=article> <div class=content-title> <h1>How to sort arrays natively in Bash</h1> <div class="well small">on 2024-02-20 in <a href=https://vorakl.com/categories/howto/ >howto</a> about <a href=https://vorakl.com/tags/bash/ >bash</a> <a href=https://vorakl.com/tags/programming/ >programming</a> ~5 min read </div> <p><h3 style="text-decoration-line: none">Sorting arrays in pure Bash with the asort built-in command</h3></p> </div> <div class=content><p><a class="reference internal" href=#summary>TLDR: quick summary of the article</a></p> <div class=line-block> <div class=line><br></div> </div> <p>What would you do if, while implementing some solution in Bash, you suddenly needed to have an array in a sorted order? You might think of the <em>sort</em> tool from the <em>coreutils</em> package. Or you might even think that it's probably a good time to switch to Python or some other language? But it turns out that Bash supports sorting arrays natively! All you need is the <strong>asort</strong> built-in command. However, it is often not loaded by default, or even packaged on many modern Linux distributions. In this article I'll show you how to build and install Bash with all loadable modules from source, load them, and start writing faster, more advanced Bash scripts with less use of external commands.</p> <div class=line-block> <div class=line><br></div> </div> <p>First of all, check your Bash version. Version 5.2-release is the target of this article:</p> <div class=highlight><pre><span></span><span class=nb>echo</span> <span class=si>${</span><span class=nv>BASH_VERSION</span><span class=si>}</span>
</pre></div> <div class=line-block> <div class=line><br></div> </div> <p>The built-in loadable modules are loaded with the <strong>enable</strong> command. Bash expects to find loadable modules in one of the paths specified in the <strong>BASH_LOADABLES_PATH</strong> environment variable, which is a colon-separated list of directories. Setting this variable and enabling all the necessary commands can be done, for example, with <em>.bashrc</em>. If you are currently running a pre-installed Bash, check that the <em>asort</em> command is not loaded and it cannot be loaded due to its absence:</p> <div class=highlight><pre><span></span><span class=nb>enable</span> -p <span class=p>|</span> grep asort <span class=o>||</span> <span class=o>{</span> <span class=nb>enable</span> -f asort asort <span class=o>&amp;&amp;</span> <span class=nb>enable</span> -p <span class=p>|</span> grep asort<span class=p>;</span> <span class=o>}</span>
</pre></div> <div class=line-block> <div class=line><br></div> </div> <p>If you see &quot;<em>enable asort</em>&quot; on the screen then the <em>asort</em> builtin is loaded and you can start using it, for example, by checking its help message:</p> <div class=highlight><pre><span></span>asort --help
</pre></div> <div class=line-block> <div class=line><br></div> </div> <p>Otherwise, let's build it from source. First of all, clone the project's official git repository and enter its directory:</p> <div class=highlight><pre><span></span>git clone https://git.savannah.gnu.org/git/bash.git <span class=o>&amp;&amp;</span> <span class=nb>cd</span> bash
</pre></div> <div class=line-block> <div class=line><br></div> </div> <p>The following procedure is pretty standard for any software written in C: you <em>configure</em> the build tools for the specific system, then you build the software, and then you install it on the system. During a configuration step, for example, you can change a default (/usr/local) installation path prefix. I'm going to override it with the same directory as the default. The loadable built-in commands can only be built after the main tool set is built:</p> <div class=highlight><pre><span></span>./configure --prefix<span class=o>=</span>/usr/local
make
make -C examples/loadables all others
sudo make install
sudo make -C examples/loadables install
sudo cp -v examples/loadables/<span class=o>{</span>necho,hello,cat,pushd,asort<span class=o>}</span> /usr/local/lib/bash/
</pre></div> <div class=line-block> <div class=line><br></div> </div> <p>Loadable built-in commands are installed in <em>/usr/local/lib/bash/</em> and Bash itself in <em>/usr/local/bin/</em>. The trick with copying files is needed because the <em>asort</em> command is part of the extra commands and, as of this writing and Bash version 5.2.26, the Makefile doesn't support installing it. If all commands finished with no errors, you'll be able to find the loadable commands in the <em>/usr/local/lib/bash/</em> directory. They are <em>shared objects</em> that can be analyzed in the typical way:</p> <div class=highlight><pre><span></span><span class=nb>cd</span> /usr/local/lib/bash
ldd asort
file asort
</pre></div> <div class=line-block> <div class=line><br></div> </div> <p>To load built-in commands from these files, you need to know a name of the structure that was defined in the source code. Some files contain only one command, so there is only one such structure, some contain two commands and two structures. You can find out these names by checking the symbol table and looking for the pattern <em>&lt;name&gt;_struct</em>:</p> <div class=highlight><pre><span></span>$ objdump -t asort <span class=p>|</span> grep _struct
00000000000040c0 g     O .data      <span class=m>0000000000000030</span>              asort_struct

$ objdump -t truefalse <span class=p>|</span> grep _struct
<span class=m>0000000000004020</span> g     O .data      <span class=m>0000000000000030</span>              false_struct
<span class=m>0000000000004060</span> g     O .data      <span class=m>0000000000000030</span>              true_struct
</pre></div> <div class=line-block> <div class=line><br></div> </div> <p>Make sure the <em>BASH_LOADABLES_PATH</em> environment variable is set and contains <em>/usr/local/lib/bash</em>, the directory where we installed the built-in commands. Now, everything is ready for testing. Let's run a newly built Bash, and load <em>asort</em> and a few other useful commands, just as an example, using the names we found in the symbol table:</p> <div class=highlight><pre><span></span>/usr/local/bin/bash
<span class=nb>echo</span> <span class=si>${</span><span class=nv>BASH_VERSION</span><span class=si>}</span>
<span class=nb>echo</span> <span class=si>${</span><span class=nv>BASH_LOADABLES_PATH</span><span class=si>}</span>
<span class=nb>enable</span> -f asort asort
<span class=nb>enable</span> -f truefalse <span class=nb>true</span>
<span class=nb>enable</span> -f truefalse <span class=nb>false</span>
<span class=nb>enable</span> -f dsv dsv
dsv --help
</pre></div> <div class=line-block> <div class=line><br></div> </div> <p>Finally, we can perform reverse numerical sorting using only the built-in function which is dsone in-place:</p> <div class=highlight><pre><span></span>$ <span class=nb>declare</span> -a <span class=nv>arr</span><span class=o>=(</span><span class=m>3</span> <span class=m>1</span> <span class=m>15</span> <span class=m>6</span> <span class=m>4</span> <span class=m>5</span> <span class=m>3</span><span class=o>)</span>

$ <span class=nb>echo</span> <span class=si>${</span><span class=nv>arr</span><span class=p>[*]</span><span class=si>}</span>
<span class=m>3</span> <span class=m>1</span> <span class=m>15</span> <span class=m>6</span> <span class=m>4</span> <span class=m>5</span> <span class=m>3</span>

$ asort -nr arr

$ <span class=nb>echo</span> <span class=si>${</span><span class=nv>arr</span><span class=p>[*]</span><span class=si>}</span>
<span class=m>15</span> <span class=m>6</span> <span class=m>5</span> <span class=m>4</span> <span class=m>3</span> <span class=m>3</span> <span class=m>1</span>
</pre></div> <div class=line-block> <div class=line><br></div> </div> <p>Having commands loaded as shared objects allows the Bash to call them directly and avoid creating new processes just to call the external tools with the same functionality. Let's do a quick experiment with <em>mkdir</em> when used as an external tool and loaded into the Bash:</p> <div class=highlight><pre><span></span>$ strace -e execve /usr/local/bin/bash -c <span class=s1>&#39;mkdir /tmp/mydir&#39;</span>

execve<span class=o>(</span><span class=s2>&quot;/usr/local/bin/bash&quot;</span>, <span class=o>[</span><span class=s2>&quot;/usr/local/bin/bash&quot;</span>, <span class=s2>&quot;-c&quot;</span>, <span class=s2>&quot;mkdir /tmp/mydir&quot;</span><span class=o>]</span>, 0x7ffd7723d6f0 /* <span class=m>68</span> vars */<span class=o>)</span> <span class=o>=</span> <span class=m>0</span>
execve<span class=o>(</span><span class=s2>&quot;/usr/bin/mkdir&quot;</span>, <span class=o>[</span><span class=s2>&quot;mkdir&quot;</span>, <span class=s2>&quot;/tmp/mydir&quot;</span><span class=o>]</span>, 0x1e2c010 /* <span class=m>67</span> vars */<span class=o>)</span> <span class=o>=</span> <span class=m>0</span>
</pre></div> <div class=highlight><pre><span></span>$ strace -e execve /usr/local/bin/bash -c <span class=s1>&#39;enable -f mkdir mkdir; mkdir /tmp/mydir2&#39;</span>

execve<span class=o>(</span><span class=s2>&quot;/usr/local/bin/bash&quot;</span>, <span class=o>[</span><span class=s2>&quot;/usr/local/bin/bash&quot;</span>, <span class=s2>&quot;-c&quot;</span>, <span class=s2>&quot;enable -f mkdir mkdir; mkdir /tm&quot;</span>...<span class=o>]</span>, 0x7ffd37695000 /* <span class=m>68</span> vars */<span class=o>)</span> <span class=o>=</span> <span class=m>0</span>
</pre></div> <div class=line-block> <div class=line><br></div> </div> <p>You can see that both executables are invoked when <em>mkdir</em> is called as an external tool. But, when <em>mkdir</em> is enabled as a built-in command, there is no an external tool execution, because the Bash calls this function directly. Besides being faster, the <em>asort</em> command has another big advantage over using an external <em>sort</em> tool. Because <em>asort</em> operates on the array data structure directly in memory, you don't have to worry about symbols contained in the array elements and just sort them in-place. They can contain newlines <cite>(0x0a or \n)</cite> or other bash specific symbols like <cite>*</cite> or <cite>?</cite>:</p> <div class=highlight><pre><span></span>$ <span class=nb>declare</span> -a <span class=nv>arr</span><span class=o>=(</span><span class=s1>&#39;**&#39;</span> <span class=s1>$&#39;abc\nxyz&#39;</span> <span class=s1>$&#39;abc\nefg&#39;</span> <span class=s1>&#39;*&#39;</span><span class=o>)</span>

$ <span class=nb>declare</span> -p arr
<span class=nb>declare</span> -a <span class=nv>arr</span><span class=o>=([</span><span class=m>0</span><span class=o>]=</span><span class=s2>&quot;**&quot;</span> <span class=o>[</span><span class=m>1</span><span class=o>]=</span><span class=s1>$&#39;abc\nxyz&#39;</span> <span class=o>[</span><span class=m>2</span><span class=o>]=</span><span class=s1>$&#39;abc\nefg&#39;</span> <span class=o>[</span><span class=m>3</span><span class=o>]=</span><span class=s2>&quot;*&quot;</span><span class=o>)</span>

$ <span class=nb>echo</span> <span class=s2>&quot;</span><span class=si>${</span><span class=nv>arr</span><span class=p>[1]</span><span class=si>}</span><span class=s2>&quot;</span>
abc
xyz

$ asort arr

$ <span class=nb>declare</span> -p arr
<span class=nb>declare</span> -a <span class=nv>arr</span><span class=o>=([</span><span class=m>0</span><span class=o>]=</span><span class=s2>&quot;*&quot;</span> <span class=o>[</span><span class=m>1</span><span class=o>]=</span><span class=s2>&quot;**&quot;</span> <span class=o>[</span><span class=m>2</span><span class=o>]=</span><span class=s1>$&#39;abc\nefg&#39;</span> <span class=o>[</span><span class=m>3</span><span class=o>]=</span><span class=s1>$&#39;abc\nxyz&#39;</span><span class=o>)</span>
</pre></div> <div class=line-block> <div class=line><br></div> </div> <p>It's also worth checking out other loadable commands such as <em>id</em>, <em>ln</em>, <em>mkfifo</em>, <em>cut</em>, <em>cat</em>, <em>stat</em>, <em>tee</em>, <em>uname</em>, and others (see the loadable modules directory). These are fairly common tools used in Bash scripting. They can all be loaded into the Bash itself, resulting in a significant overall performance improvement by eliminating the need to run external commands each time.</p> <div class=line-block> <div class=line><br></div> </div> <div class=section id=summary> <h2>Summary</h2> <ul class=simple> <li>Bash supports sorting arrays natively using the built-in <strong>asort</strong> command.</li> <li>The asort and other loadable commands are not enabled by default and may need to be compiled from source.</li> <li>To build Bash and loadable commands from source, you clone the git repository, configure, make, and install it on your system.</li> <li>The enable command is used to load builtin commands using their struct names found in the symbol table.</li> <li>Common loadable commands include <em>asort</em>, <em>truefalse</em>, <em>dsv</em>, <em>id</em>, <em>ln</em>, <em>mkdir</em>, <em>uname</em>, <em>mkdir</em>, and many others.</li> <li>Loading builtins avoids running external commands, improving performance.</li> <li>Builtin commands are shared objects that can be analyzed with <em>ldd</em>, <em>file</em>, <em>objdump</em>.</li> <li>Loadable commands are installed in <em>/usr/local/lib/bash</em> and need <em>BASH_LOADABLES_PATH</em> set to load.</li> </ul> <!-- Links --> </div> </div> </div> <div class=article style="text-align: center; font-size: 1.1em; font-style: italic"> Found a <span style="color: red; font-weight: bold">bug</span> or <span style="color: red; font-weight: bold">typo</span>? Please, send me <a href=/pages/feedback/ >feedback</a> or submit a <a href=https://github.com/vorakl/vorakl.github.io/blob/master/src.docs/content/articles/bash-sort.rst>PR on Github</a>. </div> <div class=article> <div class="well small"><h5>This is my personal blog. All ideas, opinions, examples, and other information that can be found here are my own and belong entirely to me. This is the result of my personal efforts and activities at my free time. It doesn't relate to any professional work I've done and doesn't have correlations with any companies I worked for, I'm currently working, or will work in the future.</h5></div> </div> </div> </div> </div> <footer> <div class=container> <div class=row> <div class=span5> <span class=pull-left> &copy; 2024 <a href=https://vorakl.com/pages/about/ >vorakl</a> All Rights Reserved </span> </div> <div class=span7> <div class=pull-right> Powered by <a href=https://github.com/getpelican/pelican>Pelican</a> and <a href=https://github.com/vorakl/aves>Aves</a> theme </div> </div> </div> </div> </footer> </div> </body> </html>